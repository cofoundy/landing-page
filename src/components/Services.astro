---
import { getLangFromUrl, useTranslations } from "../utils/i18n";

const currentLang = getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);

const servicesRow1 = [
  {
    title: t('services.custom_software.title'),
    description: t('services.custom_software.description'),
    icon: "üíª",
    accent: "from-[#46A0D0] to-[#1B577E]"
  },
  {
    title: t('services.it_consulting.title'),
    description: t('services.it_consulting.description'),
    icon: "üîß",
    accent: "from-[#23435F] to-[#46A0D0]"
  },
  {
    title: t('services.mvp_dev.title'),
    description: t('services.mvp_dev.description'),
    icon: "üöÄ",
    accent: "from-[#46A0D0] to-[#23435F]"
  },
  {
    title: t('services.web.title'),
    description: t('services.web.description'),
    icon: "üåê",
    accent: "from-[#46A0D0] to-[#23435F]"
  }
];

const servicesRow2 = [
  {
    title: t('services.mobile.title'),
    description: t('services.mobile.description'),
    icon: "üì±",
    accent: "from-[#1B577E] to-[#46A0D0]"
  },
  {
    title: t('services.ml.title'),
    description: t('services.ml.description'),
    icon: "ü§ñ",
    accent: "from-[#23435F] to-[#1B577E]"
  },
  {
    title: t('services.realtime.title'),
    description: t('services.realtime.description'),
    icon: "‚è±Ô∏è",
    accent: "from-[#1B577E] to-[#46A0D0]"
  },
  {
    title: t('services.cloud.title'),
    description: t('services.cloud.description'),
    icon: "‚òÅÔ∏è",
    accent: "from-[#46A0D0] to-[#1B577E]"
  },
];
---

<section id="services" class="relative bg-dark min-h-screen flex flex-col pt-20 md:pt-32 pb-16 md:pb-24 overflow-hidden">
  <!-- Animated mesh background -->
  <div class="absolute inset-0 bg-[linear-gradient(rgba(70,160,208,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(70,160,208,0.03)_1px,transparent_1px)] bg-[size:32px_32px] md:bg-[size:40px_40px] [mask-image:radial-gradient(ellipse_80%_50%_at_50%_0%,#000_70%,transparent_110%)]"></div>

  <!-- Title with animated underline -->
  <div class="container relative mx-auto px-4 mb-8 md:mb-20">
    <div class="relative inline-block left-1/2 -translate-x-1/2">
      <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white text-center tracking-wide">
        {t('services.title').toUpperCase()}
      </h2>
      <div class="absolute -bottom-3 md:-bottom-4 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent"></div>
    </div>
  </div>

  <!-- Services Auto-scroll Rows -->
  <div class="flex-1 relative space-y-8">
    <!-- First Row - Left to Right -->
    <div class="relative max-w-[1500px] mx-auto">
      <!-- Fade Edges -->
      <div class="absolute inset-y-0 left-0 w-32 bg-gradient-to-r from-dark to-transparent z-10"></div>
      <div class="absolute inset-y-0 right-0 w-32 bg-gradient-to-l from-dark to-transparent z-10"></div>

      <div id="servicesRow1" class="flex gap-4 py-4 overflow-hidden">
        <div class="flex animate-scroll-right gap-4">
          {[...servicesRow1, ...servicesRow1].map((service) => (
            <a 
              href="#contact"
              class="group relative w-[280px] sm:w-[320px] md:w-[300px] lg:w-[320px] flex-shrink-0 h-[200px] bg-white/[0.03] backdrop-blur-sm rounded-xl border border-white/10 p-6 hover:-translate-y-1 transition-all duration-300"
            >
              <div class={`absolute inset-0 bg-gradient-to-br ${service.accent} opacity-0 group-hover:opacity-10 rounded-xl transition-opacity duration-300`}></div>
              
              <div class="relative flex flex-col h-full">
                <!-- Icon -->
                <div class="text-3xl group-hover:scale-110 transition-transform duration-300">{service.icon}</div>
                
                <!-- Content -->
                <div class="mt-4">
                  <h3 class="text-sm font-bold text-white mb-2 group-hover:text-primary transition-colors duration-300">
                    {service.title}
                  </h3>
                  <p class="text-sm text-white/70 group-hover:text-white/90 transition-colors duration-300">
                    {service.description}
                  </p>
                </div>

                <!-- Arrow indicator -->
                <div class="mt-auto ml-auto opacity-0 transform translate-x-4 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300">
                  <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                  </svg>
                </div>
              </div>
            </a>
          ))}
        </div>
      </div>
    </div>

    <!-- Second Row - Right to Left -->
    <div class="relative max-w-[1500px] mx-auto">
      <!-- Fade Edges -->
      <div class="absolute inset-y-0 left-0 w-32 bg-gradient-to-r from-dark to-transparent z-10"></div>
      <div class="absolute inset-y-0 right-0 w-32 bg-gradient-to-l from-dark to-transparent z-10"></div>

      <div id="servicesRow2" class="flex gap-4 py-4 overflow-hidden">
        <div class="flex animate-scroll-left gap-4">
          {[...servicesRow2, ...servicesRow2].map((service) => (
            <a 
              href="#contact"
              class="group relative w-[280px] sm:w-[320px] md:w-[300px] lg:w-[320px] flex-shrink-0 h-[200px] bg-white/[0.03] backdrop-blur-sm rounded-xl border border-white/10 p-6 hover:-translate-y-1 transition-all duration-300"
            >
              <div class={`absolute inset-0 bg-gradient-to-br ${service.accent} opacity-0 group-hover:opacity-10 rounded-xl transition-opacity duration-300`}></div>
              
              <div class="relative flex flex-col h-full">
                <!-- Icon -->
                <div class="text-3xl group-hover:scale-110 transition-transform duration-300">{service.icon}</div>
                
                <!-- Content -->
                <div class="mt-4">
                  <h3 class="text-sm font-bold text-white mb-2 group-hover:text-primary transition-colors duration-300">
                    {service.title}
                  </h3>
                  <p class="text-sm text-white/70 group-hover:text-white/90 transition-colors duration-300">
                    {service.description}
                  </p>
                </div>

                <!-- Arrow indicator -->
                <div class="mt-auto ml-auto opacity-0 transform translate-x-4 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-300">
                  <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                  </svg>
                </div>
              </div>
            </a>
          ))}
        </div>
      </div>
    </div>
  </div>

  <!-- Call to action -->
  <div class="container relative mx-auto px-4 mt-8 md:mt-16">
    <div class="flex justify-center">
      <a 
        href="#contact"
        class="inline-flex items-center px-6 sm:px-8 py-3 sm:py-4 bg-primary hover:bg-primary-dark text-white font-medium rounded-xl transition-all duration-300 transform hover:scale-105 active:scale-95 hover:shadow-lg text-base sm:text-lg"
      >
        {t('hero.cta')}
        <svg class="ml-2 w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>
  </div>
</section>

<script>
  const servicesRow1 = document.getElementById('servicesRow1');
  const servicesRow2 = document.getElementById('servicesRow2');
  
  let touchStartX = 0;
  let isDragging = false;
  let animationId = 0;

  function handleMouseEnter(e: MouseEvent) {
    const row = e.currentTarget as HTMLElement;
    const scrollingContent = row.querySelector('div') as HTMLElement;
    if (scrollingContent) {
      scrollingContent.style.animationPlayState = 'paused';
    }
  }

  function handleMouseLeave(e: MouseEvent) {
    if (isDragging) return; // Don't resume if user is dragging
    
    const row = e.currentTarget as HTMLElement;
    const scrollingContent = row.querySelector('div') as HTMLElement;
    if (scrollingContent) {
      scrollingContent.style.animationPlayState = 'running';
    }
  }

  function handleTouchStart(e: TouchEvent) {
    const row = e.currentTarget as HTMLElement;
    touchStartX = e.touches[0].pageX;
    isDragging = true;
    
    // Pause animation while touching
    const scrollingContent = row.querySelector('div') as HTMLElement;
    if (scrollingContent) {
      scrollingContent.style.animationPlayState = 'paused';
    }
  }

  function handleTouchMove(e: TouchEvent) {
    if (!touchStartX || !isDragging) return;
    
    // Just prevent default to avoid page scroll
    e.preventDefault();
  }

  function handleTouchEnd(e: TouchEvent) {
    const row = e.currentTarget as HTMLElement;
    isDragging = false;
    
    // Resume animation after a short delay to feel natural
    setTimeout(() => {
      if (!isDragging) {
        const scrollingContent = row.querySelector('div') as HTMLElement;
        if (scrollingContent) {
          scrollingContent.style.animationPlayState = 'running';
        }
      }
    }, 500);
  }

  // Add event listeners to both rows
  [servicesRow1, servicesRow2].forEach(row => {
    if (row) {
      // Mouse events
      row.addEventListener('mouseenter', handleMouseEnter);
      row.addEventListener('mouseleave', handleMouseLeave);
      
      // Touch events
      row.addEventListener('touchstart', handleTouchStart, { passive: false });
      row.addEventListener('touchmove', handleTouchMove, { passive: false });
      row.addEventListener('touchend', handleTouchEnd, { passive: false });
    }
  });

  // Optimize animation performance
  function optimizeAnimations() {
    const rows = [servicesRow1, servicesRow2];
    rows.forEach(row => {
      if (row) {
        const scrollingContent = row.querySelector('div') as HTMLElement;
        if (scrollingContent) {
          // Enable hardware acceleration
          scrollingContent.style.willChange = 'transform';
          scrollingContent.style.backfaceVisibility = 'hidden';
          scrollingContent.style.perspective = '1000px';
        }
      }
    });
  }

  // Run optimization when page loads
  document.addEventListener('DOMContentLoaded', optimizeAnimations);
</script>

<style>
  @keyframes scroll-right {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  @keyframes scroll-left {
    0% {
      transform: translateX(-50%);
    }
    100% {
      transform: translateX(0);
    }
  }

  .animate-scroll-right {
    animation: scroll-right 12s ease-in-out infinite;
    will-change: transform;
  }

  .animate-scroll-left {
    animation: scroll-left 14s ease-in-out infinite;
    will-change: transform;
  }

  /* Smooth interaction states */
  #servicesRow1:hover .animate-scroll-right,
  #servicesRow2:hover .animate-scroll-left {
    animation-play-state: paused;
  }

  /* Enhanced mobile optimizations */
  @media (max-width: 768px) {
    .animate-scroll-right {
      animation-duration: 10s;
      animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    
    .animate-scroll-left {
      animation-duration: 11s;
      animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
  }

  /* Optimize animations for reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .animate-scroll-right,
    .animate-scroll-left {
      animation: none !important;
    }
  }

  /* Smooth scrolling optimization */
  #servicesRow1,
  #servicesRow2 {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    transform: translateZ(0); /* Force hardware acceleration */
  }

  /* Performance optimizations */
  .animate-scroll-right,
  .animate-scroll-left {
    backface-visibility: hidden;
    perspective: 1000px;
    transform-style: preserve-3d;
  }
</style>
